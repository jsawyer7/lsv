<%= render 'settings/layout', active: 'edit' do %>
  <div class="settings-form-section">
    <h3 class="settings-section-title">Profile Details</h3>
    <p class="settings-section-desc">You have full control to manage your own account setting.</p>
    <%= form_with model: @user, url: settings_path, local: true, html: { multipart: true, class: 'settings-form' } do |f| %>
      <div class="settings-avatar-section-row">
        <div class="settings-avatar-info">
          <div class="settings-avatar-preview">
            <%= image_tag(@user.avatar_url.presence || 'default-avatar.png', class: 'settings-avatar-img-lg') %>
          </div>
          <div class="settings-avatar-texts">
            <div class="settings-avatar-label">Your avatar</div>
            <div class="settings-avatar-hint">PNG or JPG no bigger than 800 KB in size.</div>
          </div>
        </div>
        <div class="settings-avatar-actions-row">
          <input type="hidden" id="remove-avatar-field" name="remove_avatar" value="false" />
          <input type="file" id="avatar-upload-input" name="user[avatar]" accept="image/png,image/jpg,image/jpeg" style="display:none;" />
          <button type="button" class="settings-avatar-update" onclick="document.getElementById('avatar-upload-input').click();">Upload</button>
          <% if @user.avatar.attached? %>
            <button type="button" class="settings-avatar-delete" onclick="removeAvatarAndPreviewAndSubmit()">Delete</button>
          <% end %>
        </div>
      </div>

      <div class="settings-background-section-row">
        <div class="settings-background-info">
          <div class="settings-background-preview">
            <% if @user.background_image_url.present? %>
              <%= image_tag(@user.background_image_url, class: 'settings-background-img') %>
            <% end %>
            <div class="settings-background-placeholder" style="<%= 'display: none;' if @user.background_image_url.present? %>">
              <i class="fas fa-image"></i>
              <span>No background image</span>
            </div>
          </div>
          <div class="settings-background-texts">
            <div class="settings-background-label">Your background</div>
            <div class="settings-background-hint">PNG or JPG no bigger than 2MB in size.</div>
          </div>
        </div>
        <div class="settings-background-actions-row">
          <input type="hidden" id="remove-background-field" name="remove_background_image" value="false" />
          <input type="file" id="background-upload-input" name="user[background_image]" accept="image/png,image/jpg,image/jpeg" style="display:none;" />
          <button type="button" class="settings-background-update" onclick="document.getElementById('background-upload-input').click();">Upload</button>
          <% if @user.background_image.attached? %>
            <button type="button" class="settings-background-delete" onclick="removeBackgroundAndPreviewAndSubmit()">Delete</button>
          <% end %>
        </div>
      </div>
      <div class="settings-form-group">
        <%= f.label :full_name, 'Your Name' %>
        <%= f.text_field :full_name, class: 'settings-input', required: true %>
      </div>
      <div class="settings-form-row">
        <div class="settings-form-group">
          <%= f.label :phone, 'Phone' %>
          <%= f.text_field :phone, class: 'settings-input' %>
        </div>
        <div class="settings-form-group">
          <%= f.label :email, 'Email' %>
          <%= f.email_field :email, class: 'settings-input', required: true, disabled: true %>
        </div>
      </div>
      <div class="settings-form-group">
        <%= f.label :about, 'About' %>
        <%= f.text_area :about, class: 'settings-textarea', rows: 3 %>
      </div>
      
      <div class="settings-form-group">
        <%= f.label :naming_preference, 'Naming Preference' %>
        <div class="settings-preference-options">
          <% @naming_preferences.each do |preference| %>
            <div class="settings-preference-option">
              <%= f.radio_button :naming_preference, preference[:id], id: "settings_#{preference[:id]}" %>
              <%= f.label "naming_preference_#{preference[:id]}", preference[:name], for: "settings_#{preference[:id]}" %>
              <span class="settings-preference-desc"><%= preference[:description] %></span>
            </div>
          <% end %>
        </div>
      </div>
      
      <%= f.submit 'Update Profile', class: 'settings-update-btn' %>
    <% end %>
  </div>
  <div id="avatar-loader" class="processing-overlay" style="display:none;z-index:10000;">
    <div class="loader-container">
      <div class="loader"></div>
      <p class="loader-text">Processing your avatar...</p>
    </div>
  </div>
  <div id="background-loader" class="processing-overlay" style="display:none;z-index:10000;">
    <div class="loader-container">
      <div class="loader"></div>
      <p class="loader-text">Processing your background image...</p>
    </div>
  </div>

  <!-- Custom Confirmation Modal -->
  <div id="confirmation-modal" class="confirmation-modal">
    <div class="confirmation-overlay"></div>
    <div class="confirmation-dialog">
      <div class="confirmation-header">
        <h3 class="confirmation-title">Confirm Action</h3>
        <button class="confirmation-close" onclick="closeConfirmationModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="confirmation-body">
        <div class="confirmation-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <p class="confirmation-message" id="confirmation-message">Are you sure you want to delete this item?</p>
        <p class="confirmation-warning">This action cannot be undone.</p>
      </div>
      <div class="confirmation-footer">
        <button class="confirmation-btn confirmation-btn-cancel" onclick="closeConfirmationModal()">Cancel</button>
        <button class="confirmation-btn confirmation-btn-confirm" id="confirmation-confirm-btn">Confirm</button>
      </div>
    </div>
  </div>

  <%= render 'shared/settings_js' %>
<% end %> 