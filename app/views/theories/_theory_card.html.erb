<div class="feed-card">
  <div class="feed-card-header">
    <div class="feed-card-badge-user">
      <% if theory.status == 'draft' %>
        <span class="my-claim-badge draft">Draft</span>
      <% else %>
        <span class="feed-card-badge theory">Theory</span>
      <% end %>
      <% user = theory.user %>
      <span class="feed-card-user">
        <img src="<%= user&.avatar_url.presence || asset_path('default-avatar.png') %>" class="my-claim-avatar" />
        <%= user&.full_name.presence || user&.email || 'Anonymous' %>
      </span>
    </div>
  </div>
  <div class="feed-card-title"><%= theory.title %></div>
  <div class="feed-card-content"><%= theory.description %></div>
  <div class="feed-card-footer">
    <% if theory.status == 'draft' %>
      <span class="feed-card-date"><%= theory.created_at.strftime('%d %b, %Y') %></span>
      <div class="feed-card-actions" style="margin-left:auto;" data-no-card-nav>
        <%= link_to edit_theory_path(theory), class: 'my-claim-edit-link' do %>
          <i class="fas fa-edit"></i> Edit
        <% end %>
        <%= link_to '#', class: 'my-claim-delete-link', data: { theory_id: theory.id } do %>
          <i class="fas fa-trash"></i> Delete
        <% end %>
      </div>
    <% else %>
      <% if user_signed_in? %>
        <% user_like = theory.likes.find_by(user: current_user) %>
        <div class="feed-card-actions" data-no-card-nav>
          <% if user_like %>
            <%= link_to theory_like_path(theory, user_like), method: :delete, remote: true, class: 'feed-like liked', data: { theory_id: theory.id } do %>
              <i class="fas fa-thumbs-up"></i> <span class="like-count"><%= theory.likes.count %></span>
            <% end %>
          <% else %>
            <%= link_to theory_likes_path(theory), method: :post, remote: true, class: 'feed-like', data: { theory_id: theory.id } do %>
              <i class="fas fa-thumbs-up"></i> <span class="like-count"><%= theory.likes.count %></span>
            <% end %>
          <% end %>
          <span class="feed-comment-count">
            <i class="fas fa-comment"></i> <span class="comment-count"><%= theory.comments.visible_to(current_user).count %></span>
          </span>
          <button class="feed-share-btn" data-shareable-type="theory" data-shareable-id="<%= theory.id %>" data-toggle="modal" data-target="#shareModal">
            <i class="fas fa-share"></i> Share
          </button>
          <button class="feed-reshare-btn" data-theory-id="<%= theory.id %>">
            <i class="fas fa-retweet"></i> Reshare
          </button>
        </div>
      <% else %>
        <div class="feed-card-actions" data-no-card-nav>
          <span class="feed-like"><i class="fas fa-thumbs-up"></i> <span class="like-count"><%= theory.likes.count %></span></span>
          <span class="feed-comment-count">
            <i class="fas fa-comment"></i> <span class="comment-count"><%= theory.comments.visible_to(current_user).count %></span>
          </span>
        </div>
      <% end %>
      <span class="feed-card-date"><%= theory.created_at.strftime('%d %b, %Y') %></span>
      <span class="feed-card-link">View Details</span>
    <% end %>
  </div>
  
  <% unless theory.status == 'draft' %>
    <div class="feed-card-comments" data-theory-id="<%= theory.id %>" data-no-card-nav>
      <div class="comments-list-mini">
        <% theory.comments.visible_to(current_user).recent.each do |comment| %>
          <%= render 'comments/comment', comment: comment %>
        <% end %>
      </div>
      <% if user_signed_in? %>
        <div class="comment-form-mini">
          <%= render 'comments/form', commentable: theory %>
        </div>
      <% end %>
    </div>
  <% end %>
</div> 