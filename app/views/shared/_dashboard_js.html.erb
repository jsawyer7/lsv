<script>
  document.addEventListener('DOMContentLoaded', function() {
    const searchForm = document.querySelector('form[data-controller="search"]');
    const searchInput = searchForm?.querySelector('input[data-search-target="input"]');
    
    if (searchForm && searchInput) {
      searchForm.addEventListener('submit', function(e) {
        e.preventDefault();
        return false;
      });

      searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          return false;
        }
      });
      
      searchInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          return false;
        }
      });
    }

    // Mobile menu toggle
    const menuToggle = document.querySelector('.menu-toggle');
    const navItems = document.querySelector('.nav-items');
    
    if (menuToggle && navItems) {
      menuToggle.addEventListener('click', function() {
        const expanded = this.getAttribute('aria-expanded') === 'true';
        this.setAttribute('aria-expanded', !expanded);
        navItems.classList.toggle('show');
      });
    }

    // Dropdown system
    class DropdownManager {
      constructor() {
        this.userProfile = document.querySelector('.user-profile');
        this.userInfo = document.querySelector('.user-info');
        this.dropdownMenu = document.querySelector('.dropdown-menu');
        
        this.isDropdownOpen = false;
        
        this.init();
      }
      
      init() {
        this.bindEvents();
      }
      
      bindEvents() {
        // Main dropdown toggle
        if (this.userInfo && this.dropdownMenu) {
          this.userInfo.addEventListener('click', (e) => {
            e.stopPropagation();
            this.toggleDropdown();
          });
        }
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
          if (!this.userProfile?.contains(e.target)) {
            this.closeDropdown();
          }
        });
        
        // Close on escape key
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            this.closeDropdown();
          }
        });
      }
      
      toggleDropdown() {
        if (this.isDropdownOpen) {
          this.closeDropdown();
        } else {
          this.showDropdown();
        }
      }
      
      showDropdown() {
        this.dropdownMenu?.classList.add('show');
        this.userInfo?.classList.add('active');
        this.isDropdownOpen = true;
      }
      
      closeDropdown() {
        this.dropdownMenu?.classList.remove('show');
        this.dropdownMenu?.classList.remove('submenu-active');
        this.dropdownMenu?.classList.remove('submenu-open');
        this.userInfo?.classList.remove('active');
        this.isDropdownOpen = false;
      }
    }
    
    // Initialize the dropdown manager
    new DropdownManager();

    document.body.addEventListener('click', function(e) {
      const card = e.target.closest('.js-card-clickable');
      if (!card) return;
      if (e.target.closest('a, button, input, textarea, [data-no-card-nav]')) return;
      const url = card.dataset.detailUrl;
      if (url) {
        e.preventDefault();
        window.location = url;
      }
    });
  });
</script> 