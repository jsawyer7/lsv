<div class="peers-page">
  <h2 class="my-claims-title">Find Peers</h2>
  <div class="my-claims-filter-bar">
    <%= link_to 'Back to Suggestions', peers_path(tab: 'suggestions'), class: "my-claims-filter active", style: 'cursor:pointer;' %>
  </div>
  <div class="peers-main">
    <div class="peers-suggestions">
      <h3 class="peers-section-title">
        <% if @provider.present? %>
          Found from <%= @provider.humanize %>
        <% else %>
          Found from Phone Contacts
        <% end %>
        (<%= @found_users.count %>)
      </h3>
      <div class="peers-suggestions-list">
        <% if @found_users.any? %>
          <% @found_users.each do |found| %>
            <% user = found[:user] %>
            <div class="peer-card">
              <div class="peer-avatar-wrap">
                <%= image_tag user.avatar_url.presence || 'default-avatar.png', class: 'peer-avatar' %>
              </div>
              <div class="peer-name-row">
                <span class="peer-name truncate-text"><%= user.full_name.presence || user.email %></span>
                <span class="peer-verified"><i class="fa fa-check-circle"></i></span>
              </div>
              <% if found[:contact_name].present? %>
                <div class="peer-match-info" style="font-size: 0.85em; color: #666; margin: 5px 0;">
                  Matched as: <%= found[:contact_name] %>
                </div>
              <% end %>
              <div class="peer-rating">★ 4.7</div>
              <% if Peer.exists?(user_id: current_user.id, peer_id: user.id, status: 'pending') %>
                <span class="add-peer-btn request-sent-text">Request Sent</span>
              <% elsif Peer.exists?(user_id: user.id, peer_id: current_user.id, status: 'pending') %>
                <%= button_to 'Accept Request', accept_peers_path(user_id: user.id), method: :post, class: 'add-peer-btn' %>
              <% else %>
                <%= button_to 'Add Peer', add_peers_path(peer_id: user.id), method: :post, class: 'add-peer-btn' %>
              <% end %>
            </div>
          <% end %>
        <% else %>
          <div class="no-requests-message">
            No peers found. 
            <% if @provider.present? %>
              Make sure you've connected your <%= @provider.humanize %> account and granted necessary permissions.
            <% else %>
              No matching users found in your contacts.
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
    <aside class="peers-sidebar with-divider">
      <div class="my-peers-section">
        <h4>My Peers</h4>
        <% my_peers = current_user.peers.limit(5) %>
        <% if my_peers.any? %>
          <% my_peers.each do |peer| %>
            <div class="my-peer-row">
              <%= image_tag peer.avatar_url.presence || 'default-avatar.png', class: 'my-peer-avatar' %>
              <span class="my-peer-name"><%= truncate(peer.full_name.presence || peer.email, length: 8) %></span>
              <span class="my-peer-verified"><i class="fa fa-check-circle"></i></span>
              <span class="my-peer-rating">★ 4.7</span>
              <%= link_to 'View Profile', user_profile_path(peer), class: 'my-peer-view-profile' %>
            </div>
          <% end %>
        <% else %>
          <div class="no-peers-message">No Peers added.</div>
        <% end %>
      </div>
    </aside>
  </div>
</div>

